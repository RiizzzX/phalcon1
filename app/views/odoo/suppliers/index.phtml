<?= $this->getContent() ?>

<style>
    .sup-table th { background: #f5f7fa; padding: 12px; text-align: left; }
    .sup-table td { padding: 10px; border-bottom: 1px solid #eef0f2; }
    .sup-row:hover { background: #fbfcfd; }
    .btn-small { padding: 8px 12px; font-size: 13px; border-radius:6px; }
    #searchSuppliers { border:1px solid #dce4ea; box-shadow: inset 0 1px 0 rgba(255,255,255,0.6); }
</style>

<div class="container" style="padding: 40px 20px;">
    <div style="margin-bottom: 20px;">
        <a href="/odoo-dashboard" style="color: #3498db; text-decoration: none;">üìä Dashboard</a> / 
        <span style="color: #7f8c8d;">üè≠ Kelola Suppliers</span>
    </div>

    <div style="margin-bottom:12px; display:flex; gap:8px; align-items:center;">
        <input id="searchSuppliers" placeholder="Cari name/email" style="flex:1; padding:10px; border-radius:6px; border:1px solid #ddd;">
        <button id="btnSearchSup" class="btn btn-primary">Cari</button>
        <button id="btnRefreshSup" class="btn btn-primary">üîÑ Refresh</button>
        <a href="/odoo-purchase" class="btn btn-secondary">‚Üê Kembali ke Purchase</a>
    </div>

    <div id="supAlert"></div>

    <div style="background: white; padding: 12px; border-radius:8px; box-shadow:0 2px 8px rgba(0,0,0,0.06);">
        <table style="width:100%; border-collapse:collapse;">
            <thead>
                <tr style="background:#f5f7fa; text-align:left;">
                    <th style="padding:10px;">ID</th>
                    <th style="padding:10px;">Nama</th>
                    <th style="padding:10px;">Email</th>
                    <th style="padding:10px;">Telepon</th>
                    <th style="padding:10px; text-align:center;">Aksi</th>
                </tr>
            </thead>
            <tbody id="suppliersBody"></tbody>
        </table>
    </div>
</div>

<script>
const API = '/api.php';
function showSupAlert(msg,type='info'){ const c=document.getElementById('supAlert'); c.innerHTML=`<div class="alert alert-${type} show">${msg}</div>`; setTimeout(()=>c.innerHTML='',3000); }
function loadSuppliers(q=''){
    fetch(`${API}?action=list_suppliers`).then(r=>r.json()).then(data=>{
        const tbody=document.getElementById('suppliersBody'); tbody.innerHTML=''; if(!data||!data.success) return showSupAlert('Gagal memuat suppliers','danger');
        let arr=data.data; if(q){ q=q.toLowerCase(); arr=arr.filter(s=> (s.name||'').toLowerCase().includes(q) || (s.email||'').toLowerCase().includes(q)); }
        arr.forEach(s=>{
            const tr=document.createElement('tr'); tr.innerHTML=`<td style="padding:10px">${s.id}</td><td style="padding:10px">${s.name||'-'}</td><td style="padding:10px">${s.email||'-'}</td><td style="padding:10px">${s.phone||'-'}</td><td style="padding:10px; text-align:center"><button class="btn btn-danger btn-small" data-id="${s.id}">Hapus</button></td>`;
            tbody.appendChild(tr);
            tr.querySelector('button').addEventListener('click', function(){ const id=this.dataset.id; if(!confirm('Hapus supplier '+(s.name||id)+'?')) return; fetch('/api.php?action=delete_supplier',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({id:id})}).then(r=>r.json()).then(resp=>{ if(resp && resp.success){ showSupAlert(resp.message||'Dihapus','success'); loadSuppliers(q);} else { showSupAlert('Gagal: '+(resp.error||'Unknown'),'danger'); } }).catch(err=>showSupAlert('Error: '+err.message,'danger')); });
        });
    }).catch(err=>showSupAlert('Error: '+err.message,'danger'));
}
window.addEventListener('DOMContentLoaded', function(){ loadSuppliers(); document.getElementById('btnRefreshSup').addEventListener('click', ()=>loadSuppliers()); document.getElementById('btnSearchSup').addEventListener('click', ()=>loadSuppliers(document.getElementById('searchSuppliers').value)); });
</script>